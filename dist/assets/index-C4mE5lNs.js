import{r as e,a as t}from"./vendor-9fiDQRhm.js";import{B as n,f as i,C as s,i as a,p as o,t as r}from"./ethers-DvTiGbll.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var c={exports:{}},l={},u=e,d=Symbol.for("react.element"),h=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,b=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g={key:!0,ref:!0,__self:!0,__source:!0};function p(e,t,n){var i,s={},a=null,o=null;for(i in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(o=t.ref),t)m.call(t,i)&&!g.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:d,type:e,key:a,ref:o,props:s,_owner:b.current}}l.Fragment=h,l.jsx=p,l.jsxs=p,c.exports=l;var f,x=c.exports,j=t;f=j.createRoot,j.hydrateRoot;const y="0xeC6881Fd6E8818Ec543579B95445eBC7050aF677",v=["function createDistribution(string memory title, uint256 totalBudget, uint256 durationInDays) external","function allocateBonus(uint256 distributionId, address recipient, bytes calldata encryptedAmount, bytes calldata proof) external","function claimBonus(uint256 distributionId) external","function finalizeDistribution(uint256 distributionId) external","function setManagerAuthorization(address manager, bool authorized) external","function getDistributionInfo(uint256 distributionId) external view returns (string memory, uint256, bool, bool, uint256, uint256, uint256)","function getBonusStatus(uint256 distributionId, address employee) external view returns (bool, bool, uint256)","function hasReceivedBonus(uint256 distributionId, address recipient) external view returns (bool)","function getCurrentDistributionId() external view returns (uint256)","function isAuthorizedManager(address manager) external view returns (bool)","function getDistributionRecipients(uint256 distributionId) external view returns (address[])","function getMyEncryptedBonus(uint256 distributionId) external view returns (uint256)","function calculateTaxBracket(uint256 amount) external view returns (uint256)","function admin() external view returns (address)","event DistributionCreated(uint256 indexed distributionId, string title, uint256 totalBudget, uint256 deadline)","event BonusAllocated(uint256 indexed distributionId, address indexed recipient)","event BonusClaimed(uint256 indexed distributionId, address indexed recipient)","event DistributionFinalized(uint256 indexed distributionId, uint256 totalDistributed)","event ManagerAuthorized(address indexed manager)","event ManagerRevoked(address indexed manager)"],w={quarterly:{title:"Q4 Performance Bonus",budget:"10.0",duration:"30"},annual:{title:"Annual Achievement Award",budget:"25.0",duration:"45"},project:{title:"Project Completion Bonus",budget:"5.0",duration:"14"},holiday:{title:"Holiday Season Bonus",budget:"15.0",duration:"21"}},C={senior:{amount:"0.5",title:"Senior Developer"},mid:{amount:"0.3",title:"Mid-Level Developer"},junior:{amount:"0.2",title:"Junior Developer"},manager:{amount:"0.8",title:"Team Lead"}},I={senior:"0xeC6881Fd6E8818Ec543579B95445eBC7050aF677",mid:"0xeC6881Fd6E8818Ec543579B95445eBC7050aF677",junior:"0xeC6881Fd6E8818Ec543579B95445eBC7050aF677",manager:"0xeC6881Fd6E8818Ec543579B95445eBC7050aF677"},N="0xaa36a7",A={chainId:N,chainName:"Sepolia Test Network",rpcUrls:["https://sepolia.infura.io/v3/","https://ethereum-sepolia.publicnode.com"],nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io/"]};function D(e){return`${e.slice(0,6)}...${e.slice(-4)}`}function k(e,t){switch(t){case"number":return!isNaN(Number(e))&&Number(e)>0;case"address":return function(e){try{return a(e)}catch{return!1}}(e);case"string":return e.trim().length>0;default:return!1}}const M=({state:e,children:t})=>x.jsx("div",{className:"container",children:x.jsxs("div",{className:"terminal-box",children:[x.jsxs("div",{className:"header",children:[x.jsxs("div",{className:"logo-section",children:[x.jsx("div",{className:"logo",children:"🔐"}),x.jsx("h1",{className:"title",children:"Anonymous Bonus Distribution"}),x.jsx("h2",{className:"subtitle",children:"Team Incentive Privacy System"})]}),x.jsxs("div",{className:"blockchain-info",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"LIVE ON SEPOLIA"})," - Encrypted bonus distribution active!"]}),x.jsxs("p",{children:["Contract: ",x.jsx("span",{className:"highlight",children:D(y)})]})]})]}),e.userAccount&&x.jsxs("div",{className:"user-info",children:[x.jsxs("p",{children:["> Connected: ",x.jsx("span",{className:"highlight",children:D(e.userAccount)})]}),x.jsxs("p",{children:["> Role: ",x.jsx("span",{className:"highlight",children:e.isManager?"👑 Manager":"👤 Employee"})]}),x.jsxs("p",{children:["> Current Distribution: ",x.jsxs("span",{className:"highlight",children:["#",e.currentDistributionId]})]})]}),e.distributionInfo&&x.jsxs("div",{className:"distribution-info",children:[x.jsxs("h3",{children:['> Current Distribution: "',e.distributionInfo.title,'"']}),x.jsxs("p",{children:["> Total Budget: ",x.jsxs("span",{className:"highlight",children:[Number(e.distributionInfo.totalBudget)/1e18," ETH"]})]}),x.jsxs("p",{children:["> Status: ",x.jsx("span",{className:"highlight",children:e.distributionInfo.isActive?"🟢 Active":e.distributionInfo.isFinalized?"✅ Finalized":"⏸️ Inactive"})]}),x.jsxs("p",{children:["> Recipients: ",x.jsx("span",{className:"highlight",children:Number(e.distributionInfo.recipientCount)})]}),x.jsxs("p",{children:["> Deadline: ",x.jsx("span",{className:"highlight",children:new Date(1e3*Number(e.distributionInfo.deadline)).toLocaleDateString()})]}),e.bonusStatus&&x.jsx("div",{className:"bonus-status",children:x.jsxs("p",{children:["> Your Bonus Status:",e.bonusStatus.hasBonus?e.bonusStatus.hasClaimed?x.jsx("span",{className:"highlight",children:" ✅ Claimed"}):x.jsx("span",{className:"highlight",children:" 💰 Available to Claim"}):x.jsx("span",{className:"highlight",children:" ⏳ Not Allocated"})]})})]}),x.jsxs("div",{className:"terminal-text",children:[x.jsx("p",{children:"🌟 Welcome to Anonymous Bonus Distribution System"}),x.jsx("p",{children:"⚡ Powered by Zama's Fully Homomorphic Encryption (FHE)"}),x.jsx("p",{children:"🔒 All bonus amounts are encrypted on-chain"}),x.jsx("p",{children:"👁️ Only recipients can see their bonus amounts"}),x.jsx("p",{children:"🎯 Managers can allocate bonuses without revealing amounts to others"}),x.jsx("p",{children:"🏆 Perfect for confidential team incentive programs"})]}),x.jsx("div",{className:`message-box ${e.message.type}`,children:x.jsxs("p",{children:["> ",e.message.text]})}),x.jsx("div",{className:"main-content",children:t}),x.jsx("div",{className:"footer",children:x.jsx("p",{children:"🔒 Secure • 🕶️ Private • 🌐 Transparent • ⚡ Built with Zama FHE"})})]})}),S=({connectWallet:e,isLoading:t})=>x.jsx("div",{className:"wallet-section",children:x.jsx("button",{className:"button wallet-button "+(t?"loading":""),onClick:e,disabled:t,children:t?"Connecting...":"Connect Wallet"})}),L=({state:t,updateContractInfo:n,setMessage:i,setLoading:s})=>{const[a,c]=e.useState({distributionTitle:"",totalBudget:"",duration:"",selectedDistributionId:"",recipientAddress:"",bonusAmount:"",finalizeDistributionId:""}),l=(e,t)=>{c(n=>({...n,[e]:t}))};return t.isManager?x.jsxs("div",{className:"manager-section",children:[x.jsx("h3",{children:"> Manager Actions"}),x.jsxs("div",{className:"quick-templates",children:[x.jsx("h4",{children:"Quick Templates"}),x.jsx("div",{className:"template-buttons",children:Object.entries(w).map(([e,n])=>x.jsx("button",{className:"button template-btn",onClick:()=>(e=>{const t=w[e];t&&(c(e=>({...e,distributionTitle:t.title,totalBudget:t.budget,duration:t.duration})),i(`Template "${t.title}" applied`,"success"))})(e),disabled:t.isLoading,children:n.title},e))})]}),x.jsxs("div",{className:"form-group",children:[x.jsx("h4",{children:"Create New Distribution"}),x.jsx("input",{className:"input-box",type:"text",placeholder:"Distribution title",value:a.distributionTitle,onChange:e=>l("distributionTitle",e.target.value),disabled:t.isLoading}),x.jsx("input",{className:"input-box",type:"number",placeholder:"Total budget (ETH)",step:"0.01",value:a.totalBudget,onChange:e=>l("totalBudget",e.target.value),disabled:t.isLoading}),x.jsx("input",{className:"input-box",type:"number",placeholder:"Duration (days)",min:"1",max:"365",value:a.duration,onChange:e=>l("duration",e.target.value),disabled:t.isLoading}),x.jsx("button",{className:"button create-button",onClick:async()=>{if(!t.contract||t.isLoading)return;const{distributionTitle:e,totalBudget:s,duration:r}=a;if(!k(e,"string")||!k(s,"number")||!k(r,"number"))return void i("Please fill all fields with valid values!","error");await t.executeTransaction("createDistribution",[e,o(s),parseInt(r)],`Creating distribution "${e}"`)&&(c(e=>({...e,distributionTitle:"",totalBudget:"",duration:""})),await n())},disabled:t.isLoading||!a.distributionTitle||!a.totalBudget||!a.duration,children:t.isLoading?"Creating...":"Create Distribution"})]}),x.jsxs("div",{className:"form-group",children:[x.jsx("h4",{children:"Allocate Encrypted Bonus"}),x.jsxs("select",{className:"input-box",value:a.selectedDistributionId,onChange:e=>l("selectedDistributionId",e.target.value),disabled:t.isLoading,children:[x.jsx("option",{value:"",children:"Select Distribution"}),t.currentDistributionId>0&&x.jsxs("option",{value:t.currentDistributionId,children:["Distribution #",t.currentDistributionId]})]}),x.jsxs("div",{className:"employee-presets",children:[x.jsx("h5",{children:"Employee Presets"}),x.jsx("div",{className:"preset-buttons",children:Object.entries(C).map(([e,n])=>x.jsxs("button",{className:"button preset-btn",onClick:()=>(e=>{const t=C[e],n=I[e];t&&(c(e=>({...e,bonusAmount:t.amount,recipientAddress:n||e.recipientAddress})),i(`Preset for ${t.title} applied (${t.amount} ETH)`,"success"))})(e),disabled:t.isLoading,children:[n.title," (",n.amount," ETH)"]},e))})]}),x.jsx("input",{className:"input-box",type:"text",placeholder:"Employee wallet address",value:a.recipientAddress,onChange:e=>l("recipientAddress",e.target.value),disabled:t.isLoading}),x.jsx("input",{className:"input-box",type:"number",placeholder:"Bonus amount (ETH)",step:"0.01",value:a.bonusAmount,onChange:e=>l("bonusAmount",e.target.value),disabled:t.isLoading}),x.jsx("button",{className:"button allocate-button",onClick:async()=>{if(!t.contract||t.isLoading)return;const{selectedDistributionId:e,recipientAddress:s,bonusAmount:l}=a;if(!k(e,"number")||!k(s,"address")||!k(l,"number"))return void i("Please fill all fields with valid values!","error");const u=o(l),d=r(u,32);await t.executeTransaction("allocateBonus",[parseInt(e),s,d,"0x"],`Allocating encrypted bonus of ${l} ETH to ${s.slice(0,6)}...${s.slice(-4)}`)&&(c(e=>({...e,recipientAddress:"",bonusAmount:""})),await n())},disabled:t.isLoading||!a.selectedDistributionId||!a.recipientAddress||!a.bonusAmount,children:t.isLoading?"Allocating...":"Allocate Encrypted Bonus"})]}),x.jsxs("div",{className:"form-group",children:[x.jsx("h4",{children:"Finalize Distribution"}),x.jsxs("select",{className:"input-box",value:a.finalizeDistributionId,onChange:e=>l("finalizeDistributionId",e.target.value),disabled:t.isLoading,children:[x.jsx("option",{value:"",children:"Select Distribution to Finalize"}),t.currentDistributionId>0&&x.jsxs("option",{value:t.currentDistributionId,children:["Distribution #",t.currentDistributionId]})]}),x.jsx("button",{className:"button finalize-button",onClick:async()=>{if(!t.contract||t.isLoading)return;const{finalizeDistributionId:e}=a;if(!k(e,"number"))return void i("Please select a distribution!","error");await t.executeTransaction("finalizeDistribution",[parseInt(e)],`Finalizing distribution #${e}`)&&await n()},disabled:t.isLoading||!a.finalizeDistributionId,children:t.isLoading?"Finalizing...":"Finalize Distribution"})]})]}):null},T=({state:t,updateContractInfo:n,setMessage:i,setLoading:s})=>{const[a,o]=e.useState(""),r=t.bonusStatus?.hasBonus&&!t.bonusStatus?.hasClaimed,c=t.bonusStatus?.hasBonus;return x.jsxs("div",{className:"employee-section",children:[x.jsx("h3",{children:"> Employee Actions"}),r&&x.jsxs("div",{className:"form-group",children:[x.jsx("h4",{children:"Claim Your Bonus"}),x.jsxs("select",{className:"input-box",value:a,onChange:e=>o(e.target.value),disabled:t.isLoading,children:[x.jsx("option",{value:"",children:"Select Distribution"}),t.currentDistributionId>0&&x.jsxs("option",{value:t.currentDistributionId,children:["Distribution #",t.currentDistributionId]})]}),x.jsx("button",{className:"button claim-button",onClick:async()=>{if(!t.contract||t.isLoading)return;const e=a||t.currentDistributionId.toString();if(!k(e,"number"))return void i("Please select a distribution!","error");await t.executeTransaction("claimBonus",[parseInt(e)],`Claiming your bonus from distribution #${e}`)&&await n()},disabled:t.isLoading,children:t.isLoading?"Claiming...":"Claim My Bonus 💰"})]}),!c&&t.userAccount&&x.jsxs("div",{className:"no-bonus-message",children:[x.jsx("p",{children:"> No bonus allocated to your address in current distribution"}),x.jsx("p",{children:"> Please contact your manager if you believe this is an error"})]}),t.bonusStatus?.hasClaimed&&x.jsxs("div",{className:"claimed-message",children:[x.jsx("p",{children:"> ✅ You have successfully claimed your bonus!"}),x.jsx("p",{children:"> Thank you for your contribution to the team"})]})]})};function B(){const t=(()=>{const[t,a]=e.useState({userAccount:null,contract:null,isManager:!1,currentDistributionId:0,isLoading:!1,distributionInfo:null,bonusStatus:null,message:{text:"Connect MetaMask to access Anonymous Bonus Distribution!",type:"info"}}),[o,r]=e.useState(null),[c,l]=e.useState(null),u=e.useCallback((e,t="info")=>{a(n=>({...n,message:{text:e,type:t}})),"success"===t&&setTimeout(()=>{a(e=>({...e,message:{text:"Ready for next action",type:"info"}}))},5e3)},[]),d=e.useCallback(e=>{a(t=>({...t,isLoading:e}))},[]),h=e.useCallback(()=>!(!window.ethereum||!window.ethereum.isMetaMask)||(u("MetaMask is required! Please install MetaMask browser extension.","error"),!1),[u]),m=e.useCallback(async()=>{try{if(await window.ethereum.request({method:"eth_chainId"})!==N){u("Switching to Sepolia testnet...","info");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:N}]})}catch(e){if(4902!==e.code)throw e;u("Adding Sepolia network to MetaMask...","info"),await window.ethereum.request({method:"wallet_addEthereumChain",params:[A]})}}return!0}catch(t){return console.error("Network switch failed:",t),u("Failed to switch to Sepolia network. Please switch manually in MetaMask.","error"),!1}},[u]),b=e.useCallback(async()=>{try{if(!h())return;if(d(!0),u("Connecting to MetaMask..."),0===(await window.ethereum.request({method:"eth_requestAccounts"})).length)return void u("No accounts found. Please create an account in MetaMask.","error");if(!(await m()))return;const t=new n(window.ethereum),o=await t.getSigner(),c=await o.getAddress();console.log("Connected account:",c);const b=await t.getBalance(c);console.log("Account balance:",i(b),"ETH"),0n===b&&u("Your account has no Sepolia ETH. Please get test ETH from a faucet.","warning");const g=new s(y,v,o);try{await g.admin(),console.log("Contract connection verified")}catch(e){return console.error("Contract connection failed:",e),void u("Contract not found. Please check if it's deployed on Sepolia.","error")}r(t),l(o),a(e=>({...e,userAccount:c,contract:g})),u("Successfully connected to MetaMask and Sepolia! 🔐","success")}catch(e){console.error("Wallet connection failed:",e),4001===e.code?u("Connection rejected by user. Please try again.","warning"):-32002===e.code?u("MetaMask is already processing a request. Please check MetaMask.","warning"):u("Failed to connect to MetaMask. Please try again.","error")}finally{d(!1)}},[h,m,u,d]),g=e.useCallback(async(e,n,i)=>{if(!t.contract||!c)return u("Please connect your wallet first","error"),null;try{d(!0),u(`Preparing ${i}...`);const s=120n*await t.contract[e].estimateGas(...n)/100n;u(`Please confirm the transaction in MetaMask for: ${i}`);const a=await t.contract[e](...n,{gasLimit:s});u(`Transaction submitted! Hash: ${a.hash.slice(0,10)}...`),console.log("Transaction hash:",a.hash),u("Waiting for transaction confirmation...");const o=await a.wait();return 1===o.status?(u(`${i} completed successfully! 🎉`,"success"),console.log("Transaction confirmed:",o),o):(u(`${i} failed. Please try again.`,"error"),null)}catch(s){return console.error("Transaction failed:",s),4001===s.code?u("Transaction rejected by user","warning"):-32603===s.code?u("Transaction failed. Please check your balance and try again.","error"):s.message?.includes("insufficient funds")?u("Insufficient Sepolia ETH for gas fees. Please get test ETH from a faucet.","error"):s.message?.includes("user rejected")?u("Transaction cancelled by user","warning"):u(`Transaction failed: ${s.message||"Unknown error"}`,"error"),null}finally{d(!1)}},[t.contract,c,u,d]),p=e.useCallback(async()=>{if(t.contract&&t.userAccount)try{console.log("Updating contract info...");const e=Number(await t.contract.getCurrentDistributionId()),n=await t.contract.isAuthorizedManager(t.userAccount);if(console.log("Current distribution ID:",e),console.log("Is manager:",n),a(t=>({...t,currentDistributionId:e,isManager:n})),e>0){const n=await t.contract.getDistributionInfo(e),i={title:n[0],totalBudget:n[1],isActive:n[2],isFinalized:n[3],createdAt:n[4],deadline:n[5],recipientCount:n[6]};console.log("Distribution info:",i);const s=await t.contract.getBonusStatus(e,t.userAccount),o={hasBonus:s[0],hasClaimed:s[1],timestamp:s[2]};console.log("Bonus status:",o),a(e=>({...e,distributionInfo:i,bonusStatus:o}))}}catch(e){console.error("Failed to update contract info:",e),u("Failed to load contract information","error")}},[t.contract,t.userAccount,u]),f=e.useCallback(e=>{console.log("Accounts changed:",e),0===e.length?(a(e=>({...e,userAccount:null,contract:null,isManager:!1,distributionInfo:null,bonusStatus:null})),r(null),l(null),u("Wallet disconnected","warning")):e[0]!==t.userAccount&&window.location.reload()},[t.userAccount,u]),x=e.useCallback(e=>{console.log("Chain changed to:",e),e!==N?(u("Please switch back to Sepolia testnet","warning"),a(e=>({...e,contract:null,distributionInfo:null,bonusStatus:null}))):window.location.reload()},[u]);return e.useEffect(()=>{if(window.ethereum)return window.ethereum.on("accountsChanged",f),window.ethereum.on("chainChanged",x),()=>{window.ethereum?.removeListener("accountsChanged",f),window.ethereum?.removeListener("chainChanged",x)}},[f,x]),e.useEffect(()=>{t.contract&&t.userAccount&&p()},[t.contract,t.userAccount,p]),e.useEffect(()=>{(async()=>{if(window.ethereum)try{const e=await window.ethereum.request({method:"eth_accounts"});e.length>0&&(console.log("Already connected account found:",e[0]),b())}catch(e){console.error("Failed to check existing connection:",e)}})()},[b]),{...t,provider:o,signer:c,connectWallet:b,executeTransaction:g,updateContractInfo:p,setMessage:u,setLoading:d,isMetaMaskInstalled:h()}})();return x.jsx(M,{state:t,children:t.userAccount?x.jsxs(x.Fragment,{children:[x.jsx(L,{state:t,updateContractInfo:t.updateContractInfo,setMessage:t.setMessage,setLoading:t.setLoading}),x.jsx(T,{state:t,updateContractInfo:t.updateContractInfo,setMessage:t.setMessage,setLoading:t.setLoading})]}):x.jsx(S,{connectWallet:t.connectWallet,isLoading:t.isLoading})})}f(document.getElementById("root")).render(x.jsx(e.StrictMode,{children:x.jsx(B,{})}));
